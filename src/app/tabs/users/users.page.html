<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Users</ion-title>
  </ion-toolbar>

  <!-- Search Bar -->
  <ion-toolbar>
    <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="onSearch()" placeholder="Search users..." debounce="300"
      animated="true">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" pullingText="Pull to refresh"
      refreshingSpinner="circles" refreshingText="Refreshing...">
    </ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading users...</p>
  </div>

  <!-- Empty State - No Results -->
  <div class="empty-state" *ngIf="!isLoading && filteredUsers.length === 0 && searchTerm.length > 0">
    <ion-icon name="search-outline" class="empty-icon"></ion-icon>
    <h2>No Users Found</h2>
    <p>No users match "{{ searchTerm }}"</p>
  </div>

  <!-- Empty State - No Users -->
  <div class="empty-state" *ngIf="!isLoading && allUsers.length === 0 && searchTerm.length === 0">
    <ion-icon name="people-outline" class="empty-icon"></ion-icon>
    <h2>No Users Found</h2>
    <p>No other users are registered yet</p>
  </div>

  <!-- Users List -->
  <div class="users-container" *ngIf="!isLoading && filteredUsers.length > 0">
    <div class="users-header">
      <h3>{{ filteredUsers.length }} {{ filteredUsers.length === 1 ? 'user' : 'users' }}{{ searchTerm ? ' found' : '
        registered' }}</h3>
    </div>

    <ion-list lines="none">
      <ion-item *ngFor="let user of filteredUsers" class="user-item" (click)="viewUserDetails(user.id)" button>
        <ion-avatar slot="start">
          <img [src]="user.photoURL || 'https://ionicframework.com/docs/img/demos/avatar.svg'"
            [alt]="user.displayName" />
        </ion-avatar>

        <ion-label>
          <h2>{{ user.displayName }}</h2>
          <p>{{ user.email }}</p>
        </ion-label>

        <ion-button slot="end" [fill]="isFollowing(user.id) ? 'outline' : 'solid'"
          [color]="isFollowing(user.id) ? 'medium' : 'primary'" size="small" (click)="toggleFollow(user, $event)">
          <ion-icon [name]="isFollowing(user.id) ? 'person-remove-outline' : 'person-add-outline'"
            slot="start"></ion-icon>
          {{ isFollowing(user.id) ? 'Unfollow' : 'Follow' }}
        </ion-button>
      </ion-item>
    </ion-list>
  </div>
</ion-content>
